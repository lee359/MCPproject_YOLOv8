# YOLOv8 MCP Server 系統運作流程圖 v1.1

## 📊 標準流程圖符號使用指南

本文檔使用標準流程圖符號來描述 YOLOv8 MCP Server 系統的完整運作流程。

---

## 🎨 流程圖符號圖例

| 符號 | 圖形 | 名稱 | 用途 |
|------|------|------|------|
| ⭕ | 圓角矩形 | 開始/結束 | 流程的起點和終點 |
| 📋 | 矩形 | 流程 | 處理步驟、運算操作 |
| 💎 | 菱形 | 判定 | 條件分支、決策點 |
| 📱 | 凸形矩形 | 外部實體 | 外部系統、硬體設備 |
| 📄 | 波浪底矩形 | 文件 | 數據文檔、訊息 |
| 📊 | 圓柱形 | 資料庫 | 持久化數據、模型文件 |
| 🗄️ | 開口矩形 | 內部存儲 | 內存中的數據結構 |
| 🔄 | 六角形 | 預備 | 迴圈控制 |

---

## 🔄 完整系統流程圖（使用標準符號）

```
┌─────────────────────────────────────────────────────────────┐
│ ⭕ 開始: 用戶呼叫 detect_esp32_stream()                      │
└────────────────────┬────────────────────────────────────────┘
                     ↓
╔════════════════════════════════════════════════════════════╗
║ 📱 外部實體: Claude Desktop (用戶界面)                      ║
║    ┌──────────────────────────────────────────────────┐    ║
║    │ • 接收用戶輸入                                    │    ║
║    │ • 生成 JSON-RPC 請求                             │    ║
║    │ • 管理 MCP 子進程                                │    ║
║    └──────────────────────────────────────────────────┘    ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 📄 文件: JSON-RPC 請求                                      │
│    {                                                        │
│      "jsonrpc": "2.0",                                     │
│      "method": "tools/call",                               │
│      "params": {                                           │
│        "name": "detect_esp32_stream",                      │
│        "arguments": {                                      │
│          "imgsz": 416,                                     │
│          "conf": 0.25,                                     │
│          "frame_skip": 1,                                  │
│          "use_kalman": true                                │
│        }                                                    │
│      }                                                      │
│    }                                                        │
└────────────────────┬───────────────────────────────────────┘
                     ↓ (通過 stdin)
╔════════════════════════════════════════════════════════════╗
║ 📋 流程: MCP 協議層 (Model Context Protocol)                ║
║    ┌──────────────────────────────────────────────────┐    ║
║    │ 1. 讀取 claude_desktop_config.json               │    ║
║    │ 2. 啟動 Python 子進程 (mcpclient.py)             │    ║
║    │ 3. 解析 JSON-RPC 請求                            │    ║
║    │ 4. 路由到對應工具函數                             │    ║
║    │ 5. 管理 stdio 通訊                               │    ║
║    └──────────────────────────────────────────────────┘    ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
╔════════════════════════════════════════════════════════════╗
║ 📋 流程: MCP Server 初始化 (mcpclient.py)                   ║
║    ┌──────────────────────────────────────────────────┐    ║
║    │ • 載入 YOLO 模型 (best.pt)                       │    ║
║    │ • 檢測 GPU 可用性                                │    ║
║    │ • 初始化 Kalman Filter 系統                      │    ║
║    │ • 解析工具參數                                    │    ║
║    └──────────────────────────────────────────────────┘    ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: CUDA 可用?                                         │
└────────┬───────────────────┬───────────────────────────────┘
         │ Yes               │ No
         ↓                   ↓
┌─────────────────┐   ┌─────────────────┐
│ 📋 流程:         │   │ 📋 流程:        │
│ model.to('cuda')│   │ 使用 CPU 運行   │
└────────┬────────┘   └────────┬────────┘
         └───────────┬──────────┘
                     ↓
╔════════════════════════════════════════════════════════════╗
║ 📋 流程: 連接 ESP32-CAM                                     ║
║    cap = cv2.VideoCapture(stream_url)                      ║
║    cap.set(cv2.CAP_PROP_BUFFERSIZE, 1)                     ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓ (HTTP GET 請求)
╔════════════════════════════════════════════════════════════╗
║ 📱 外部實體: ESP32-CAM (硬體設備)                           ║
║    ┌──────────────────────────────────────────────────┐    ║
║    │ 網路配置:                                         │    ║
║    │  • IP: 192.168.0.103:81                          │    ║
║    │  • Endpoint: /stream                             │    ║
║    ├──────────────────────────────────────────────────┤    ║
║    │ 視頻流:                                           │    ║
║    │  • 格式: MJPEG                                   │    ║
║    │  • 幀率: ~30 FPS                                 │    ║
║    └──────────────────────────────────────────────────┘    ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓ (MJPEG 視頻流)
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: 連接成功?                                          │
└────────┬───────────────────┬───────────────────────────────┘
         │ Yes               │ No
         ↓                   ↓
         │            ┌──────────────────────────────────────┐
         │            │ 📋 流程: 返回錯誤                     │
         │            │    return {                          │
         │            │      "success": false,               │
         │            │      "error": "無法連接到串流"        │
         │            │    }                                 │
         │            └────────────┬─────────────────────────┘
         │                         ↓
         │                  ┌─────────────┐
         │                  │ ⭕ 結束      │
         │                  └─────────────┘
         ↓
╔════════════════════════════════════════════════════════════╗
║ 🔄 預備: 多幀處理迴圈                                       ║
║    for frame_count in range(frames_to_process):            ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 📋 流程: 讀取影像幀                                         │
│    ret, frame = cap.read()                                 │
└────────────────────┬───────────────────────────────────────┘
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: frame_count % frame_skip == 0?                    │
└────────┬───────────────────┬───────────────────────────────┘
         │ No (跳過此幀)      │ Yes (處理此幀)
         ↓                   ↓
   ┌──────────┐       ╔═════════════════════════════════════╗
   │ 繼續迴圈 │       ║ 📋 流程: YOLO 物體偵測              ║
   └────┬─────┘       ║    results = model.predict(         ║
        │             ║      source=frame,                  ║
        │             ║      imgsz=imgsz,                   ║
        └────────┐    ║      conf=conf                      ║
                 │    ║    )                                ║
                 │    ╚══════════┬══════════════════════════╝
                 │               ↓
                 │    ┌─────────────────────────────────────┐
                 │    │ 📋 流程: 提取檢測結果                │
                 │    │    current_detections = [           │
                 │    │      {                              │
                 │    │        'bbox': [...],               │
                 │    │        'conf': 0.87,                │
                 │    │        'cls': 0                     │
                 │    │      }                              │
                 │    │    ]                                │
                 │    └────────────┬────────────────────────┘
                 │                 ↓
                 │    ┌─────────────────────────────────────┐
                 │    │ 🗄️ 內部存儲: 更新物體年齡           │
                 │    │    for obj_id in tracked_objects:   │
                 │    │      age += 1                       │
                 │    │    移除 age > max_age 的物體         │
                 │    └────────────┬────────────────────────┘
                 │                 ↓
                 │    ┌─────────────────────────────────────┐
                 │    │ 💎 判定: use_kalman == True?        │
                 │    └────┬────────────────┬───────────────┘
                 │         │ Yes            │ No
                 │         ↓                ↓
                 │  ╔═══════════════╗  ┌──────────────────┐
                 │  ║ 📋 流程:       ║  │ 📋 流程:          │
                 │  ║ Kalman 追蹤   ║  │ 直接使用檢測結果  │
                 │  ║───────────────║  └────────┬─────────┘
                 │  ║ 1. 計算中心點  ║           │
                 │  ║ 2. 匹配物體    ║           │
                 │  ║ 3. kf.predict()║           │
                 │  ║ 4. kf.update() ║           │
                 │  ╚═══════┬═══════╝           │
                 │          └──────────┬─────────┘
                 │                     ↓
                 │         ┌────────────────────────────────┐
                 │         │ 🗄️ 內部存儲: tracked_objects   │
                 │         │    {                           │
                 │         │      obj_id: {                 │
                 │         │        'kf': kalman_filter,    │
                 │         │        'bbox': [...],          │
                 │         │        'conf': 0.87,           │
                 │         │        'cls': 0,               │
                 │         │        'age': 0                │
                 │         │      }                         │
                 │         │    }                           │
                 │         └────────────┬───────────────────┘
                 │                      ↓
                 └──────────────────────┘
                          │
                          ↓ (迴圈結束)
┌────────────────────────────────────────────────────────────┐
│ 📋 流程: 讀取最後一幀用於繪圖                               │
│    ret, frame = cap.read()                                 │
│    cap.release()                                           │
└────────────────────┬───────────────────────────────────────┘
                     ↓
╔════════════════════════════════════════════════════════════╗
║ 🔄 預備: 繪製追蹤結果迴圈                                   ║
║    for obj_id, tracked in tracked_objects.items():         ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: age <= display_tolerance?                         │
└────────┬───────────────────┬───────────────────────────────┘
         │ No (跳過)          │ Yes (繪製)
         ↓                   ↓
   ┌──────────┐       ╔═════════════════════════════════════╗
   │ 繼續迴圈 │       ║ 📋 流程: 計算繪製座標                ║
   └────┬─────┘       ║    if use_kalman:                   ║
        │             ║      使用平滑後的中心點              ║
        │             ║    else:                            ║
        └────────┐    ║      使用原始邊界框                  ║
                 │    ╚══════════┬══════════════════════════╝
                 │               ↓
                 │    ┌─────────────────────────────────────┐
                 │    │ 📋 流程: 繪製視覺化元素              │
                 │    │    cv2.rectangle(                   │
                 │    │      annotated_frame,               │
                 │    │      (x1, y1), (x2, y2),            │
                 │    │      (0, 255, 0), 2                 │
                 │    │    )                                │
                 │    │    cv2.putText(                     │
                 │    │      label, (x1, y1-5)              │
                 │    │    )                                │
                 │    └────────────┬────────────────────────┘
                 │                 ↓
                 └─────────────────┘
                          │
                          ↓ (迴圈結束)
┌────────────────────────────────────────────────────────────┐
│ 📋 流程: 圖像編碼                                           │
│    _, buffer = cv2.imencode('.jpg', annotated_frame)       │
│    img_base64 = base64.b64encode(buffer).decode('utf-8')   │
└────────────────────┬───────────────────────────────────────┘
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 📋 流程: 封裝 JSON 回應                                     │
│    result = {                                              │
│      "success": true,                                      │
│      "detections": detections,                             │
│      "detection_count": len(detections),                   │
│      "tracked_objects_count": len(tracked_objects),        │
│      "annotated_image_base64": img_base64,                 │
│      "frame_size": {...},                                  │
│      "parameters": {...},                                  │
│      "performance": {...}                                  │
│    }                                                        │
└────────────────────┬───────────────────────────────────────┘
                     ↓
┌────────────────────────────────────────────────────────────┐
│ 📄 文件: JSON-RPC 回應                                      │
│    {                                                        │
│      "jsonrpc": "2.0",                                     │
│      "id": 1,                                              │
│      "result": {                                           │
│        "success": true,                                    │
│        "detections": [                                     │
│          {                                                 │
│            "class": "person",                              │
│            "confidence": 0.87,                             │
│            "bbox": [100, 150, 300, 450],                   │
│            "age": 0                                        │
│          }                                                 │
│        ],                                                  │
│        "annotated_image_base64": "iVBORw0KG...",           │
│        "performance": {                                    │
│          "total_time": 1.23,                               │
│          "predict_time": 0.45                              │
│        }                                                    │
│      }                                                      │
│    }                                                        │
└────────────────────┬───────────────────────────────────────┘
                     ↓ (通過 stdout)
╔════════════════════════════════════════════════════════════╗
║ 📋 流程: MCP 協議層                                         ║
║    • 讀取 JSON 回應 (從 stdout)                            ║
║    • 解析 JSON 結構                                        ║
║    • 轉發給 Claude Desktop                                 ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
╔════════════════════════════════════════════════════════════╗
║ 📱 外部實體: Claude Desktop                                 ║
║    ┌──────────────────────────────────────────────────┐    ║
║    │ • 解析 JSON 回應                                  │    ║
║    │ • 解碼 Base64 圖像                               │    ║
║    │ • 顯示檢測結果給用戶                              │    ║
║    └──────────────────────────────────────────────────┘    ║
╚════════════════════┬═══════════════════════════════════════╝
                     ↓
┌────────────────────────────────────────────────────────────┐
│ ⭕ 結束: 用戶查看偵測結果                                   │
└────────────────────────────────────────────────────────────┘
```

---

## 📊 數據流向與儲存位置

### 1. 配置文件
```
┌────────────────────────────────────────────────────────────┐
│ 📄 文件: claude_desktop_config.json                        │
│    位置: C:\Users\user\AppData\Roaming\Claude\             │
│                                                             │
│    {                                                        │
│      "mcpServers": {                                       │
│        "YOLOv8 Detection Server": {                        │
│          "command": "python.exe",                          │
│          "args": ["mcpclient.py"],                         │
│          "env": {"PYTHONPATH": "..."}                      │
│        }                                                    │
│      }                                                      │
│    }                                                        │
└────────────────────────────────────────────────────────────┘
```

### 2. 模型文件
```
┌────────────────────────────────────────────────────────────┐
│ 📊 資料庫: YOLO 模型權重                                    │
│    文件: best.pt                                            │
│    位置: C:\Users\user\MCPproject-YOLOv8\                  │
│    大小: ~6-14 MB (視訓練數據而定)                          │
│    用途: YOLOv8 物體偵測推論                                │
└────────────────────────────────────────────────────────────┘
```

### 3. 運行時數據
```
┌────────────────────────────────────────────────────────────┐
│ 🗄️ 內部存儲: 追蹤物體字典 (tracked_objects)                │
│    類型: Python Dictionary                                 │
│    生命週期: 單次工具調用期間                               │
│    結構:                                                    │
│    {                                                        │
│      0: {                                                   │
│        'kf': <KalmanFilter object>,                        │
│        'bbox': [100, 150, 300, 450],                       │
│        'conf': 0.87,                                       │
│        'cls': 0,                                           │
│        'age': 0                                            │
│      },                                                     │
│      1: { ... }                                            │
│    }                                                        │
└────────────────────────────────────────────────────────────┘
```

---

## 🔀 關鍵判斷節點詳解

### 判斷 1: CUDA 可用性檢測
```
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: torch.cuda.is_available()                         │
└────────┬───────────────────┬───────────────────────────────┘
         │ True              │ False
         ↓                   ↓
┌─────────────────┐   ┌─────────────────┐
│ 📋 流程:         │   │ 📋 流程:        │
│ model.to('cuda')│   │ model.to('cpu') │
│ GPU 推論        │   │ CPU 推論        │
│ (更快)          │   │ (較慢)          │
└─────────────────┘   └─────────────────┘
```
**影響**: GPU 可加速 3-10 倍推論速度

---

### 判斷 2: 串流連接狀態
```
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: cap.isOpened()                                    │
└────────┬───────────────────┬───────────────────────────────┘
         │ True              │ False
         ↓                   ↓
┌─────────────────┐   ┌─────────────────────────────────────┐
│ 📋 流程:         │   │ 📋 流程: 返回錯誤                    │
│ 繼續讀取影像幀   │   │    {                                │
│                 │   │      "success": false,              │
│                 │   │      "error": "無法連接到串流"       │
│                 │   │    }                                │
└─────────────────┘   └────────────┬────────────────────────┘
                                   ↓
                            ┌─────────────┐
                            │ ⭕ 結束      │
                            └─────────────┘
```
**影響**: 決定是否能繼續處理或提前返回錯誤

---

### 判斷 3: 幀跳過控制
```
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: frame_count % frame_skip == 0                     │
└────────┬───────────────────┬───────────────────────────────┘
         │ True (處理)        │ False (跳過)
         ↓                   ↓
┌─────────────────┐   ┌─────────────────┐
│ 📋 流程:         │   │ 📋 流程:        │
│ YOLO 推論       │   │ 跳過此幀        │
│ Kalman 追蹤     │   │ 繼續下一幀      │
└─────────────────┘   └─────────────────┘
```
**影響**: 控制 FPS（frame_skip=30 → 1 FPS）

---

### 判斷 4: Kalman Filter 啟用
```
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: use_kalman == True                                │
└────────┬───────────────────┬───────────────────────────────┘
         │ True              │ False
         ↓                   ↓
╔═══════════════════╗   ┌─────────────────────────────────┐
║ 📋 流程:           ║   │ 📋 流程:                        │
║ Kalman 追蹤       ║   │ 直接使用 YOLO 檢測結果          │
║───────────────────║   │                                 │
║ 1. 計算物體中心    ║   │ tracked_objects[id] = {         │
║ 2. 匹配已有物體    ║   │   'bbox': det['bbox'],          │
║ 3. kf.predict()   ║   │   'conf': det['conf'],          │
║ 4. kf.update()    ║   │   'cls': det['cls'],            │
║ 5. 平滑位置       ║   │   'age': 0                      │
║                   ║   │ }                               │
╚═══════════════════╝   └─────────────────────────────────┘
```
**影響**: 減少檢測框閃爍，提升追蹤穩定性

---

### 判斷 5: 物體顯示判定
```
┌────────────────────────────────────────────────────────────┐
│ 💎 判定: tracked['age'] <= display_tolerance               │
└────────┬───────────────────┬───────────────────────────────┘
         │ True              │ False
         ↓                   ↓
┌─────────────────┐   ┌─────────────────┐
│ 📋 流程:         │   │ 📋 流程:        │
│ 繪製此物體       │   │ 跳過此物體      │
│ (顯示邊界框)     │   │ (不顯示)        │
└─────────────────┘   └─────────────────┘
```
**影響**: 控制臨時未匹配物體的顯示（減少閃爍）

---

## 🔄 迴圈控制節點

### 迴圈 1: 多幀處理
```
╔════════════════════════════════════════════════════════════╗
║ 🔄 預備: 多幀處理迴圈                                       ║
║    frames_to_process = max(frame_skip * 3, 5)              ║
║    for _ in range(frames_to_process):                      ║
║      1. 讀取影像幀                                          ║
║      2. 判斷是否處理                                        ║
║      3. YOLO 推論 (如果需要)                               ║
║      4. Kalman 追蹤 (如果啟用)                             ║
╚════════════════════════════════════════════════════════════╝
```
**目的**: 累積多幀數據以改善 Kalman Filter 追蹤效果

---

### 迴圈 2: 繪製追蹤結果
```
╔════════════════════════════════════════════════════════════╗
║ 🔄 預備: 繪製追蹤結果迴圈                                   ║
║    for obj_id, tracked in tracked_objects.items():         ║
║      if tracked['age'] <= display_tolerance:               ║
║        1. 計算繪製座標                                      ║
║        2. 繪製邊界框                                        ║
║        3. 繪製標籤                                          ║
╚════════════════════════════════════════════════════════════╝
```
**目的**: 為所有符合條件的追蹤物體繪製視覺化元素

---

## 📡 通訊協議詳解

### stdio 雙向通訊
```
┌─────────────────────────────────────────────────────────────┐
│                    Claude Desktop (主進程)                   │
└────────────┬────────────────────────┬───────────────────────┘
             │ stdin (輸入)            │ stdout (輸出)
             ↓                        ↑
    ┌────────────────┐       ┌────────────────┐
    │ JSON-RPC 請求   │       │ JSON-RPC 回應   │
    │ (序列化)        │       │ (反序列化)      │
    └────────┬───────┘       └───────┬────────┘
             ↓                        ↑
┌────────────┴────────────────────────┴───────────────────────┐
│              MCP Server (mcpclient.py) - 子進程              │
│  • 從 stdin 讀取請求                                         │
│  • 處理業務邏輯                                              │
│  • 將結果寫入 stdout                                         │
└─────────────────────────────────────────────────────────────┘
```

**重要規則**:
- ✅ stdout 只能輸出 JSON-RPC 訊息
- ✅ 調試訊息必須使用 stderr
- ✅ 每條訊息以換行符 `\n` 分隔

---

## 🎯 關鍵參數對流程的影響

### 1. frame_skip (幀跳過)
```
frame_skip = 1  → 每幀都處理 (30 FPS → 30 FPS)
             ↓
┌───────────────────────────────────────────┐
│ 💎 frame_count % 1 == 0 → 永遠 True       │
│    所有幀都會進行 YOLO 推論               │
└───────────────────────────────────────────┘

frame_skip = 30 → 每30幀處理一次 (30 FPS → 1 FPS)
             ↓
┌───────────────────────────────────────────┐
│ 💎 frame_count % 30 == 0 → 僅在特定幀 True│
│    跳過 29 幀，只處理第 30 幀             │
└───────────────────────────────────────────┘
```

---

### 2. max_age (物體最大存活幀數)
```
max_age = 5
    ↓
╔═══════════════════════════════════════════╗
║ 🗄️ 物體年齡管理:                          ║
║    age = 0 → 剛偵測到                     ║
║    age = 1 → 1 幀未匹配                   ║
║    age = 2 → 2 幀未匹配                   ║
║    ...                                    ║
║    age = 5 → 5 幀未匹配                   ║
║    age > 5 → 刪除物體                     ║
╚═══════════════════════════════════════════╝
```
**影響**: 控制暫時消失物體的保留時間

---

### 3. display_tolerance (顯示容忍度)
```
display_tolerance = 3
    ↓
┌───────────────────────────────────────────┐
│ 💎 age <= 3 → 顯示                        │
│ 💎 age > 3  → 隱藏 (但仍在追蹤)           │
└───────────────────────────────────────────┘
```
**影響**: 減少檢測框閃爍

---

### 4. conf (信心度閾值)
```
conf = 0.25
    ↓
╔═══════════════════════════════════════════╗
║ 📋 YOLO 推論:                             ║
║    偵測信心度 0.87 → 保留                 ║
║    偵測信心度 0.42 → 保留                 ║
║    偵測信心度 0.23 → 丟棄 ✗               ║
║    偵測信心度 0.15 → 丟棄 ✗               ║
╚═══════════════════════════════════════════╝
```
**影響**: 過濾低質量檢測，減少誤報

---

## 🛠️ 4個工具的流程差異

### 工具 1: detect_esp32_stream() - 完整版
```
⭕ 開始
  ↓
📱 連接 ESP32-CAM
  ↓
🔄 多幀處理迴圈 (frame_skip * 3)
  ↓
📋 YOLO 推論
  ↓
💎 使用 Kalman?
  ↓
🗄️ 追蹤物體管理
  ↓
📋 繪製標註
  ↓
📋 Base64 編碼
  ↓
📄 返回完整 JSON (含圖像)
  ↓
⭕ 結束
```

---

### 工具 2: detect_stream_frame_simple() - 簡化版
```
⭕ 開始
  ↓
📱 連接 ESP32-CAM
  ↓
📋 讀取單幀
  ↓
📋 YOLO 推論
  ↓
📄 返回簡化 JSON (不含圖像) ← 關鍵差異
  ↓
⭕ 結束
```
**省略**: Kalman 追蹤、多幀處理、圖像編碼

---

### 工具 3: check_stream_health() - 診斷版
```
⭕ 開始
  ↓
📋 HTTP 連接測試
  ↓
💎 HTTP 成功?
  ↓
📋 OpenCV 連接測試
  ↓
💎 OpenCV 成功?
  ↓
📋 讀取幀測試
  ↓
📄 返回診斷報告
  ↓
⭕ 結束
```
**目的**: 快速診斷連接問題，不進行 YOLO 推論

---

### 工具 4: detect_image() - 靜態圖片版
```
⭕ 開始
  ↓
📄 讀取本地圖片
  ↓
📋 YOLO 推論
  ↓
📋 繪製標註
  ↓
📋 Base64 編碼
  ↓
📄 返回 JSON (含圖像)
  ↓
⭕ 結束
```
**差異**: 不連接 ESP32-CAM，不使用 Kalman 追蹤

---

## 📚 流程圖版本歷史

### v1.2 (2025-11-05)
- ✅ 採用標準流程圖符號
- ✅ 詳細的判斷節點說明
- ✅ 迴圈控制可視化
- ✅ 參數影響分析
- ✅ 4個工具的流程對比

### v1.0 (2025-11-05)
- 初始版本：雙向通訊流程圖

---

## 📖 相關文檔

- [系統運作流程圖 v1.0](workflow.md)
- [MCP 實現技術報告](mcp_implementation_technical_report.md)
- [MCP 工具使用指南](mcp_tools_usage_guide.md)
- [串流同步優化](stream_sync_optimization.md)

---

**文檔版本**: v1.2  
**最後更新**: 2025-11-05  
**符號標準**: ISO 5807 流程圖符號  
**作者**: YOLOv8 MCP Server Team
